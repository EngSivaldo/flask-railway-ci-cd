# .github/workflows/deploy.yml

name: CI/CD Deploy Flask/Python para Railway

# 1. Gatilho: O workflow ser√° executado em push para a branch 'main'
on:
  push:
    branches:
      - main
  # Permite a execu√ß√£o manual do workflow na aba Actions do GitHub
  workflow_dispatch:

# Define o conjunto de jobs que o workflow ir√° executar
jobs:
  deploy:
    runs-on: ubuntu-latest

    # Define as vari√°veis de ambiente para o job de deploy
    env:
      RAILWAY_SERVICE_ID: seu_service_id_do_railway
      RAILWAY_DEPLOY_BRANCH: main

    steps:
      - name: ‚öôÔ∏è Checkout do C√≥digo
        # A√ß√£o para baixar o c√≥digo do reposit√≥rio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # **Passos de Configura√ß√£o Espec√≠ficos para Python/Flask**
      - name: üêç Configurar Python
        # A√ß√£o para configurar o ambiente Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13" # Ajuste a vers√£o do Python, use uma est√°vel.
          cache: "pip" # Otimiza o processo de instala√ß√£o de depend√™ncias

      - name: üì¶ Instalar Depend√™ncias (requirements.txt)
        # Comando para instalar as depend√™ncias listadas no arquivo requirements.txt
        run: pip install -r requirements.txt

      # O Flask geralmente n√£o requer um passo de "Build" separado como o frontend.
      # O Railway ir√° executar o comando de "Start" configurado por voc√™.

      - name: üöÄ Deploy para Railway
        # Usaremos a CLI (Command Line Interface) do Railway para o deploy
        uses: railwayapp/cli@master
        with:
          # O token de deploy criado na etapa 1, referenciado pelo segredo do GitHub
          token: ${{ secrets.RAILWAY_DEPLOYMENT_TOKEN }}
          # O comando de deploy, utilizando as vari√°veis de ambiente
          command: railway up --service ${{ env.RAILWAY_SERVICE_ID }} --service-branch ${{ env.RAILWAY_DEPLOY_BRANCH }} --detach
